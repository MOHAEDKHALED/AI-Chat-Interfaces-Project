<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Mini ChatGPT</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:#eee; margin:0; padding:0; display:flex; height:100vh; }
.sidebar { width:250px; background:#1a1a1a; padding:10px; display:flex; flex-direction:column; gap:10px; }
#conversations { flex:1; overflow-y:auto; border:1px solid #333; padding:8px; }
.conv-item { padding:8px; background:#222; border:1px solid #333; margin-bottom:6px; cursor:pointer; border-radius:6px; }
.conv-item.active { background:#004466; }
.main { flex:1; padding:15px; display:flex; flex-direction:column; }
#messages { flex:1; overflow-y:auto; border:1px solid #333; padding:12px; background:#000; border-radius:8px; }
.msg { margin:6px 0; padding:8px; border-radius:8px; max-width:75%; }
.msg.user { background:#003366; margin-left:auto; }
.msg.assistant { background:#003300; margin-right:auto; }
.input-area { display:flex; gap:8px; margin-top:10px; }
input, button, select { padding:10px; border-radius:6px; border:1px solid #555; background:#222; color:white; }
button { cursor:pointer; background:#0066ff; border:none; }
#apiKeyInput { width:100%; }
</style>
</head>
<body>

<div class="sidebar">
  <button id="newChat">+ New Chat</button>
  <select id="modelSelect">
    <option value="gpt-4o-mini">gpt-4o-mini</option>
    <option value="gpt-4.1-mini">gpt-4.1-mini</option>
  </select>
  <input id="apiKeyInput" placeholder="Enter API Key here" />
  <div id="conversations"></div>
</div>

<div class="main">
  <h2 id="convTitle">New Chat</h2>
  <div id="messages"></div>
  <div class="input-area">
    <input id="inputText" placeholder="Type your message..." />
    <button id="sendBtn">Send</button>
  </div>
</div>

<script>
let conversations = JSON.parse(localStorage.getItem("convs") || "[]");
let currentId = null;

function save() { localStorage.setItem("convs", JSON.stringify(conversations)); }

function newConversation() {
  const id = Date.now();
  conversations.unshift({ id, title:"Chat "+conversations.length, messages:[] });
  currentId = id;
  save();
  render();
}

function render() {
  const list = document.getElementById("conversations");
  list.innerHTML="";
  conversations.forEach(c=>{
    const div=document.createElement("div");
    div.className="conv-item"+(c.id===currentId?" active":"");
    div.textContent=c.title;
    div.onclick=()=>{ currentId=c.id; render(); };
    list.appendChild(div);
  });

  const conv = conversations.find(c=>c.id===currentId);
  const msgBox = document.getElementById("messages");
  msgBox.innerHTML="";
  if(conv){
    conv.messages.forEach(m=>{
      const d=document.createElement("div");
      d.className="msg "+m.role;
      d.textContent=m.content;
      msgBox.appendChild(d);
    });
  }
}

async function sendMessage(){
  const text=document.getElementById("inputText").value.trim();
  const apiKey=document.getElementById("apiKeyInput").value.trim();
  const model=document.getElementById("modelSelect").value;
  if(!text) return;
  if(!apiKey) return alert("Enter API Key first");
  if(!currentId) newConversation();

  const conv = conversations.find(c=>c.id===currentId);
  conv.messages.push({role:"user",content:text});
  save(); render();
  document.getElementById("inputText").value="";

  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+apiKey
    },
    body:JSON.stringify({model, messages:conv.messages})
  });

  const data = await response.json();
  const reply = data.choices[0].message.content;
  conv.messages.push({role:"assistant",content:reply});
  save(); render();
}

document.getElementById("newChat").onclick=newConversation;
document.getElementById("sendBtn").onclick=sendMessage;
document.getElementById("inputText").onkeydown=e=>{ if(e.key==="Enter") sendMessage(); };

if(conversations.length===0) newConversation(); else currentId=conversations[0].id;
render();
</script>

</body>
</html>
