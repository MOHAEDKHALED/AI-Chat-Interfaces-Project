<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gemini Chat</title>

  <style>
    body { font-family: Arial; background: #f2f2f2; margin:0; display:flex; flex-direction:column; height:100vh; }
    #chatBox { flex: 1; overflow-y:auto; padding: 20px; }
    .msg { margin-bottom: 12px; padding: 10px; border-radius: 7px; max-width: 70%; line-height: 1.4; }
    .me { background:#0084ff; color:#fff; margin-left:auto; }
    .ai { background:#e8e8e8; color:#000; margin-right:auto; }
    #inputArea { padding: 10px; display:flex; gap:10px; background:#fff; }
    #inputArea input { flex:1; padding:10px; border-radius:6px; border:1px solid #ccc; }
    #inputArea button { padding:10px 14px; border:none; border-radius:6px; cursor:pointer; background:#0084ff; color:#fff; }
    #topBar { background:#fff; padding:10px 20px; border-bottom:1px solid #ddd; display:flex; justify-content:space-between; align-items:center; }
    #tokens { font-size:14px; color:#444; }
  </style>

</head>
<body>

<div id="topBar">
  <button onclick="newChat()">ðŸ†• New Chat</button>
  <div id="tokens">Tokens Used: 0</div>
</div>

<div id="chatBox"></div>

<div id="inputArea">
  <input id="textInput" placeholder="Type your message...">
  <button onclick="send()">Send</button>
</div>

<script>
  const API_KEY = "";
  const MODEL = "gemini-2.0-flash-001";

  let conversation = []; 
  let totalTokensUsed = 0;

  async function send() {
    const userText = document.getElementById("textInput").value.trim();
    if (!userText) return;
    addMessage(userText, "me");
    document.getElementById("textInput").value = "";

    conversation.push({ role: "user", parts: [{ text: userText }] });

    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ contents: conversation })
      }
    );

    const result = await response.json();
    console.log(result);

    const aiText = result?.candidates?.[0]?.content?.parts?.[0]?.text || "No response";
    addMessage(aiText, "ai");

    conversation.push({ role: "model", parts: [{ text: aiText }] });

    updateTokens(result.usageMetadata?.totalTokenCount || 0);
  }

  function addMessage(text, sender) {
    const chatBox = document.getElementById("chatBox");
    const div = document.createElement("div");
    div.className = "msg " + sender;
    div.innerText = text;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function newChat() {
    conversation = [];
    totalTokensUsed = 0;
    document.getElementById("tokens").innerText = "Tokens Used: 0";
    document.getElementById("chatBox").innerHTML = "";
  }

  function updateTokens(tokensUsed) {
    totalTokensUsed += tokensUsed;
    document.getElementById("tokens").innerText = `Tokens Used: ${totalTokensUsed}`;
  }
</script>

</body>
</html>
